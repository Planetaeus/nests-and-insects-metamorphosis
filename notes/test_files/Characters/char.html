<!DOCTYPE html>
<html>
	<head>
		<title>Character Sheet</title>
		<style>
			.form-group {
				display: flex;
				align-items: left;
				margin-right: 20px;
			}
			label {
				display: inline-block;
				width: 100px;
			}
			
			label[class="disp-label"] {
				width: auto;
				text-align: left;
			}
			
			input[type="text"] {
				width: 93px;
			}
			input[type="text"][class="long-text"] {
				width: 315px;
			}
			input[type=checkbox] {
				appearance: none;
                width: 10px;
                height: 10px;
                border: 1px solid black;
                border-radius: 50%;
			}
			input[type=checkbox]:checked {
				background: red;
			}
			
			.form-row {
				display: flex;
				align-items: left;
			}
			.area-div {
				margin-left: 20px;
				margin-top: 30px;
			}
			div[id="atks-inner"] {
				display: flex;
				alighn-items: left;
			}
		</style>
		
	</head>
	
	<body>
		<div class="area-div">
			<div>
				<strong>Nests & Insects: Metamorphosis</strong>
			</div>
			<input type="file" id="inputfile">
			<script>
				document.getElementById('inputfile')
					.addEventListener('change', function () {

						let fr = new FileReader();
						fr.onload = function () {
							let strData = fr.result;
							let jsonData = JSON.parse(strData);
									
							loadFromJSON(jsonData);
						}

						fr.readAsText(this.files[0]);
					})
					
				function loadFromJSON(jData) {
					let form = document.getElementById("char-form");
					let formData = {};
					for (let i = 0; i < form.elements.length; i++) {
						let element = form.elements[i];
						if(element.type == "checkbox") {
							element.checked = jData[element.name]
						}
						else if (element.type !== "submit") {
							element.value = jData[element.name]
						}
					}
				}
			</script>
			<form id="char-form">
				<br>
				<div id="name-div" class="form-row">
					<label for="char_name" class="label_text">Char name:</label>
					<input type="text" id="char_name" name="char_name" placeholder="John Insect">
				</div>
				<div class="form-row">
					<div id="core-div">
						<br>
						<strong>Core Attributes</strong>
						<div class="form-row">
							<div class="form-group">
								<label for="SPE">Speed:</label>
								<input type="number" id="SPE" name="SPE" min="0" max="10" value="0">
							</div>
							<div class="form-group">
								<label for="STR">Strength:</label>
								<input type="number" id="STR" name="STR" min="0" max="10" value="0">
							</div>
						</div>
						<div class="form-row">
							<div class="form-group">
								<label for="KEN">Ken:</label>
								<input type="number" id="KEN" name="KEN" min="0" max="10" value="0">
							</div>
							<div class="form-group">
								<label for="PAS">Passions:</label>
								<input type="number" id="PAS" name="PAS" min="0" max="10" value="0">
							</div>
						</div>
					</div>
					<div id="special-div">
						<br>
						<strong>Special Attributes</strong>
						<div class="form-row">
							<div class="form-group">
								<input type="text" id="special_1" name="special_1" placeholder="Special 1">
								<input type="number" id="special_1" name="special_1" min="0" max="10" value="0">
							</div>
							<div class="form-group">
								<input type="text" id="special_2" name="special_2" placeholder="Special 2">
								<input type="number" id="special_2" name="special_2" min="0" max="10" value="0">
							</div>
						</div>
						<div class="form-row">
							<div class="form-group">
								<input type="text" id="special_3" name="special_3" placeholder="Special 3">
								<input type="number" id="special_3" name="special_3" min="0" max="10" value="0">
							</div>
							<div class="form-group">
								<input type="text" id="special_4" name="special_4" placeholder="Special 4">
								<input type="number" id="special_4" name="special_4" min="0" max="10" value="0">
							</div>
						</div>
					</div>
				</div>
				<div class="form-row">
					<div id="common-div">
						<br>
						<strong>Common Attributes</strong>
						<div class="form-row">
							<div>
								<div class="form-group">
									<label for="construction">Construction:</label>
									<input type="number" id="construction" name="Construction" min="0" max="10" value="0">
								</div>
								<div class="form-group">
									<label for="eusociology">Eusociology:</label>
									<input type="number" id="eusociology" name="eusociology" min="0" max="10" value="0">
								</div>
								<div class="form-group">
									<label for="exploration">Exploration:</label>
									<input type="number" id="exploration" name="exploration" min="0" max="10" value="0">
								</div>
								<div class="form-group">
									<label for="foraging">Foraging:</label>
									<input type="number" id="foraging" name="foraging" min="0" max="10" value="0">
								</div>
								<div class="form-group">
									<label for="Healing">Healing:</label>
									<input type="number" id="healing" name="healing" min="0" max="10" value="0">
								</div>
							</div>
							<div>
								<div class="form-group">
									<label for="hunting">Hunting:</label>
									<input type="number" id="hunting" name="hunting" min="0" max="10" value="0">
								</div>
								<div class="form-group">
									<label for="leadership">Leadership:</label>
									<input type="number" id="leadership" name="leadership" min="0" max="10" value="0">
								</div>
								<div class="form-group">
								<label for="perception">Perception:</label>
									<input type="number" id="perception" name="Perception" min="0" max="10" value="0">
								</div>
								<div class="form-group">
									<label for="signaling">Signaling:</label>
									<input type="number" id="signaling" name="signaling" min="0" max="10" value="0">
								</div>
								<div class="form-group">
									<label for="sneaking">Sneaking:</label>
									<input type="number" id="sneaking" name="sneaking" min="0" max="10" value="0">
								</div>
							</div>
						</div>
					</div>
					<div id="effects-div">
					<br>
					<strong>Effects</strong>
						<div class="form-row">
							<div>
								<div class="form-group">
									<label for="agony">Agony:</label>
									<input type="number" id="agony" name="agony" min="0" max="10" value="0">
								</div>
								<div class="form-group">
									<label for="bleed">Bleeding:</label>
									<input type="number" id="bleed" name="bleed" min="0" max="10" value="0">
								</div>
								<div class="form-group">
									<label for="blind">Blind:</label>
									<input type="number" id="blind" name="blind" min="0" max="10" value="0">
								</div>
								<div class="form-group">
									<label for="burns">Burns:</label>
									<input type="number" id="burns" name="burns" min="0" max="10" value="0">
								</div>
								<div class="form-group">
									<label for="charm">Charmed:</label>
									<input type="number" id="charm" name="charm" min="0" max="10" value="0">
								</div>
								<div class="form-group">
									<label for="chill">Chills:</label>
									<input type="number" id="chill" name="chill" min="0" max="10" value="0">
								</div>
								<div class="form-group">
									<label for="confused">Confused:</label>
									<input type="number" id="confused" name="confused" min="0" max="10" value="0">
								</div>
							</div>
							<div>
								<div class="form-group">
									<label for="immobile">Immobile:</label>
									<input type="number" id="immobile" name="immobile" min="0" max="10" value="0">
								</div>
								<div class="form-group">
									<label for="infected">Infected:</label>
									<input type="number" id="infected" name="infected" min="0" max="10" value="0">
								</div>
								<div class="form-group">
									<label for="paralyzed">Paralyzed:</label>
									<input type="number" id="paralyzed" name="paralyzed" min="0" max="10" value="0">
								</div>
								<div class="form-group">
									<label for="poisoned">Poisoned:</label>
									<input type="number" id="poisoned" name="poisoned" min="0" max="10" value="0">
								</div>
								<div class="form-group">
									<label for="shocks">Shocks:</label>
									<input type="number" id="shocks" name="shocks" min="0" max="10" value="0">
								</div>
								<div class="form-group">
									<label for="stunned">Stunned:</label>
									<input type="number" id="stunned" name="stunned" min="0" max="10" value="0">
								</div>
							</div>
						</div>
					</div>
				</div>
				<div id="disposition-div">
					<strong>Disposition Track</strong>
					<br>
					<input type="radio" id="retreat" name="disposition" value="Retreating">
						<label for="retreat" class="disp-label">: Retreating |</label>
					<input type="radio" id="neg4" name="disposition" value="-4">
						<label for="neg4" class="disp-label">: -2d |</label>
					<input type="radio" id="neg3" name="disposition" value="-3">
						<label for="neg3" class="disp-label">: -2d |</label>
					<input type="radio" id="neg2" name="disposition" value="-2">
						<label for="neg2" class="disp-label">: -1d |</label>
					<input type="radio" id="neg1" name="disposition" value="-1">
						<label for="neg1" class="disp-label">: -1d |</label>
					<input type="radio" id="hold" name="disposition" value="0" checked>
						<label for="hold" class="disp-label">Holding: +0d |</label>
					<input type="radio" id="pos1" name="disposition" value="+1">
						<label for="pos1" class="disp-label">: +1d |</label>
					<input type="radio" id="pos2" name="disposition" value="+2">
						<label for="pos2" class="disp-label">: +1d |</label>
					<input type="radio" id="pos3" name="disposition" value="+3">
						<label for="pos3" class="disp-label">: +2d |</label>
					<input type="radio" id="pos4" name="disposition" value="+4">
						<label for="pos4" class="disp-label">: +2d |</label>
					<input type="radio" id="pos5" name="disposition" value="+5">
						<label for="pos5" class="disp-label">: Charging</label>
				</div>

				<div id="combat-div">
					<br>
					<strong>Combat Attributes</strong>
					<div class="form-row">
						<div id="combat-attributes">
							<div class="form-group">
								<label for="init">Initiative:</label>
								<input type="number" id="init" name="init" min="0" max="10" value="0">
							</div>
							<div class="form-row">
								<label for="tr">Threat Rate:</label>
								<input type="number" id="tr" name="tr" min="0" max="10" value="0">
							</div>
							<div class="form-row">
								<label for="sr">Survival Rate:</label>
								<input type="number" id="sr" name="sr" min="0" max="10" value="0">
							</div>
						</div>
						<div id="wounds-div">
							<div class="form-row">
								<label for="wound-max">Max Wounds:</label>
								<input type="number" id="wound-max" name="wound-max" min="0" max="10" value="0">
							</div>
							<div class="form-group">
								<label for="wound-current">Wounds:</label>
								<input type="number" id="wound-current" name="wound-current" min="0" max="10" value="0">
							</div>
							<div class="form-group">
								<label for="swarm-current">Swarms:</label>
									<input type="number" id="swarm-current" name="swarm-current" min="0" max="10" value="0">
							</div>
						</div>
					</div>
				</div>

				<div id="atks-div">
					<br>
					<div id="atks-inner">
						<div>
							<strong>Attack #1</strong>
							<div class="form-row">
								<div class="form-group">
									<label for="atk1-name">Name:</label>
									<input type="text" id="atk1-name" name="atk1-name" placeholder="Slam Attack" class="long-text">
								</div>
							</div>
							<div class="form-group">
								<br>
								<label for="atk1-text">Attack Details:</label>
								<textarea id="atk1-text" name="atk1-text" rows = "4" cols = "38">Place the details of the attack here.</textarea>
							</div>
						</div>
						<div>
							<strong>Attack #2</strong>
							<div class="form-row">
								<div class="form-group">
									<label for="atk2-name">Name:</label>
									<input type="text" id="atk2-name" name="atk2-name" placeholder="Slam Attack" class="long-text">
								</div>
							</div>
							<div class="form-group">
								<br>
								<label for="atk2-text">Attack Details:</label>
								<textarea id="atk2-text" name="atk2-text" rows = "4" cols = "38">Place the details of the attack here.</textarea>
							</div>
						</div>
					</div>
					<div id="atks-inner">
						<div>
							<strong>Attack #3</strong>
							<div class="form-row">
								<div class="form-group">
									<label for="atk3-name">Name:</label>
									<input type="text" id="atk3-name" name="atk3-name" placeholder="Slam Attack" class="long-text">
								</div>
							</div>
							<div class="form-group">
								<br>
								<label for="atk3-text">Attack Details:</label>
								<textarea id="atk3-text" name="atk3-text" rows = "4" cols = "38">Place the details of the attack here.</textarea>
							</div>
						</div>
						<div>
							<strong>Attack #4</strong>
							<div class="form-row">
								<div class="form-group">
									<label for="atk4-name">Name:</label>
									<input type="text" id="atk4-name" name="atk4-name" placeholder="Slam Attack" class="long-text">
								</div>
							</div>
							<div class="form-group">
								<br>
								<label for="atk4-text">Attack Details:</label>
								<textarea id="atk4-text" name="atk4-text" rows = "4" cols = "38">Place the details of the attack here.</textarea>
							</div>
						</div>
					</div>
				</div>
				</div>
				<div id="surv-div">
					<br>
					<div class="form-row">
						<div id="inv-div">
							<strong>Inventory</strong>
							<div class="form-group">
								<input type="text" id="item1" name="item1">
								<input type="number" id="item1-val" name="item1-val" min="0" max="10" value="0">
							</div>
							<div class="form-group">
								<input type="text" id="item2" name="item2">
								<input type="number" id="item2-val" name="item2-val" min="0" max="10" value="0">
							</div>
							<div class="form-group">
								<input type="text" id="item3" name="item3">
								<input type="number" id="item3-val" name="item3-val" min="0" max="10" value="0">
							</div>
							<div class="form-group">
								<input type="text" id="item4" name="item4">
								<input type="number" id="item4-val" name="item4-val" min="0" max="10" value="0">
							</div>
							<div class="form-group">
								<input type="text" id="item5" name="item5">
								<input type="number" id="item5-val" name="item5-val" min="0" max="10" value="0">
							</div>
						</div>
						<div>
							<div id="hunger-div">
								<div class="form-row">
									<label for="hunger"><strong>Hunger:</strong></label>
									<input type="number" id="hunger" name="hunger" min="0" max="10" value="0">
								</div>
							</div>
							<div id="xp-div">
								<div class="form-row">
									<label for="xp"><strong>Experience</strong></label>
									<input type="number" id="xp" name="xp" min="0" max="10" value="0">
								</div>
							</div>
						</div>
					</div>
				</div>
				
				
				<br>
				<button type="button" onclick="convertToJson()">Submit</button>
				<script>

					function convertToJson() {
						let form = document.getElementById("char-form");
						let formData = {};
						for (let i = 0; i < form.elements.length; i++) {
							let element = form.elements[i];
							if(element.type == "checkbox") {
								formData[element.name] = element.checked
							}
							else if (element.type !== "submit") {
								formData[element.name] = element.value;
							}
						}
						let jsonData = JSON.stringify(formData);
						let blob = new Blob([jsonData], { type: 'application/json' });
						let charName = document.getElementById("char_name").value;
						//let jsonOutput = document.getElementById("jsonOutput");
						//jsonOutput.innerHTML = "<pre>" + jsonData + "</pre>";	
						downloadFileUniversal(jsonData, charName + ".json", 'application/json');
					}
					
					function downloadFileUniversal(dataContent, fileName, mimeType) {
						const blobData = new Blob([dataContent], { type: mimeType });

						if (window.navigator.msSaveOrOpenBlob) {
							// For IE10+
							window.navigator.msSaveOrOpenBlob(blobData, fileName);
						} else {
							// For other modern browsers
							const anchorElement = document.createElement("a");
							const fileUrl = URL.createObjectURL(blobData);

							anchorElement.href = fileUrl;
							anchorElement.download = fileName;
							document.body.appendChild(anchorElement);
							anchorElement.click();

							// Clean up by removing the anchor and revoking the URL
							setTimeout(() => {
								document.body.removeChild(anchorElement);
								URL.revokeObjectURL(fileUrl);
							}, 0);
						}
					}
				</script>
			</form>
		</div>
		<div id="jsonOutput"></div>
	</body>
</html>